# -*- coding: utf-8 -*-
"""bancosapp.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ZftL7qKlkxNAimQTF4tQpmGrIpw7Xx5n
"""

import streamlit as st
import yfinance as yf
import pandas as pd
from PIL import Image
import requests
from io import BytesIO
import time
import base64

def img_to_base64(path):
    if not os.path.isfile(path):
        st.error(f"Arquivo n√£o encontrado: {path}")
        return ""
    with open(path, "rb") as img_file:
        return base64.b64encode(img_file.read()).decode()

# Dicion√°rio com dados dos bancos
bancos = {
    'BBDC4.SA': {
        'empresa': 'Banco Bradesco',
        'ticket': 'BBDC4',
        'logo_path': 'logos/bradesco.png'
    },
    'BBAS3.SA': {
        'empresa': 'Banco do Brasil',
        'ticket': 'BBAS3',
        'logo_path': 'logos/bb.png'
    },
    'ITUB4.SA': {
        'empresa': 'Ita√∫ Unibanco',
        'ticket': 'ITUB4',
        'logo_path': 'logos/itau.png'
    },
    'SANB11.SA': {
        'empresa': 'Banco Santander',
        'ticket': 'SANB11',
        'logo_path': 'logos/santander.png'
    }
}

def buscar_preco(ticker):
    try:
        stock = yf.Ticker(ticker)
        hist = stock.history(period="1d", interval="1m")
        if not hist.empty:
            return round(hist["Close"].iloc[-1], 2)
    except:
        pass
    return "N/A"

st.set_page_config(page_title="Pre√ßos em tempo real - Bancos", layout="wide")
st.title("üìä Pre√ßo em Tempo Real das A√ß√µes - Bancos B3")

refresh_interval = st.slider("‚è±Ô∏è Atualizar a cada quantos segundos?", min_value=1, max_value=60, value=1)

# Cabe√ßalho da tabela
col1, col2, col3, col4 = st.columns([1.5, 3, 2, 2])
with col1: st.markdown("**LOGO**")
with col2: st.markdown("**EMPRESA**")
with col3: st.markdown("**TICKET**")
with col4: st.markdown("**PRE√áO DA A√á√ÉO (R$)**")

for ticker, info in bancos.items():
    preco = buscar_preco(ticker)

    # converter logo para base64 para embutir no HTML
    img_base64 = img_to_base64(info["logo_path"])

    linha_html = f"""
    <div style='
        display: flex; 
        align-items: center; 
        gap: 20px; 
        height: 120px; 
        border-bottom: 1px solid #ddd;
        padding: 10px 0;
    '>
        <div style='flex: 1.5; display: flex; justify-content: center;'>
            <img src="data:image/png;base64,{img_base64}" width="100" />
        </div>
        <div style='flex: 3; display: flex; align-items: center; justify-content: center; font-weight: 600;'>{info["empresa"]}</div>
        <div style='flex: 2; display: flex; align-items: center; justify-content: center; font-weight: 600;'>{info["ticket"]}</div>
        <div style='flex: 2; display: flex; align-items: center; justify-content: center; font-weight: 600;'>R$ {preco}</div>
    </div>
    """

    st.markdown(linha_html, unsafe_allow_html=True)

    time.sleep(refresh_interval)
    st.markdown("<br>", unsafe_allow_html=True)  # espa√ßamento extra entre linhas, s√≥ aqui
    # ou use st.write("") para um espa√ßo simples, se preferir

    time.sleep(refresh_interval)
